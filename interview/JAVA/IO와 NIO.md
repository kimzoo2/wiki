
## NIO(New Input/Output)란?
- java 1.4에서 도입된 도입된 비동기, 논블로킹 I/O 방식을 의미한다. 기존 **I/O 방식이 블로킹 방식**이었기 때문에 성능 저하가 발생하여 보다 성능 향상을 위해 도입된 **비동기 및 버퍼 기반의 I/O 방식**이다.

### NIO의 주요 구성 요소
- `Channel, Buffer, Selector`

#### Channel
- 데이터를 쓰고 읽는 **입출력 통로**다. Stream과 유사하지만, **양방항 통신을 지원**한다.
- 양방향 통신을 지원하기 때문에 inputChannel, outputChannel 등이 필요하지 않다. (stream은 필요)

#### Buffer
- 데이터를 **임시로 저장하는 공간**이다.
- NIO에서는 Stream이 아니라 버퍼에 읽고 쓴다.
- 채널마다 공유해서 사용하지 않는다. (동기화 문제 때문)

#### Selector(중요!)
- 여러 채널을 **하나의 스레드로 관리하는 객체**다. (버퍼가 아닌 채널을 읽을 수 있는 상태를 확인한다.)
- 다중 I/O 처리를 위한 핵심 요소다.

### NIO 동작 흐름
1. 채널을 열고 버퍼를 생성한다.
2. 채널로 데이터를 읽고 버퍼에 저장한다.
3. 버퍼에서 데이터를 처리한 후, 다시 채널을 통해 출력한다.
4. 셀렉터를 통해 여러 채널을 하나의 스레드로 관리한다.


### NIO의 문제
- **selector는 한정적**이다.
	- selector는 하나의 스레드를 이용해 여러개의 채널을 관리한다. 하지만 채널이 무수히 많아질 경우 selector의 부하 문제가 발생할 수 있다.
- **buffer의 크기 조정 문제가 존재**한다.
	- 데이터를 저장하는 buffer는 한정된 크기를 사용한다. 하지만 전달되는 데이터는 일정한 크기가 아니기 때문에 적절한 수준을 사용해야 한다. ([[더블 버퍼링]]으로 버퍼의 부족한 공간을 최적화한다)
- buffer overflow 및 underflow 문제가 존재한다.
	- 버퍼가 가득 찼는데 추가하거나 없는데 읽으려는 시도를 하면 예외가 발생한다.
	- 항상 버퍼 상태를 확인하여 문제를 해결한다.

#### NIO도 메세지를 비동기로 전달한다. pub/sub도 메세지를 비동기로 전달한다. 둘은 비슷한 개념인가?
- 비슷하나 다르다.
	- pub/sub - 생산자가 메세지를 소비자들에게 **push**한다. (push 모델)
	- NIO - 생산자가 버퍼에 데이터를 **저장**한다. 소비자가 버퍼에서 데이터를 출력한다. (pull 모델)
- pub/sub은 **생산자가 메세지를 발행할 때 소비자들에게 전달**된다. 즉, 생산자가 메세지를 소비하는 주체가 된다. 하지만 pull 모델은 생산자가 데이터를 저장하고 **소비자가 필요할 때 메세지를 가져간다**. 즉, 소비자가 메세지를 소비하는 주체가 된다.



https://www.geeksforgeeks.org/non-blocking-server-in-java-nio/