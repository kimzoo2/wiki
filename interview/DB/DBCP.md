### Connection Pool
- 먼저 Pool이라는 공간에 **최소 커넥션을 생성**하고 애플리케이션이 Pool을 통해서 **커넥션을 사용하고 반환**하는 것을 의미합니다. Pool이라는 공간이 나타난 이유는 **커넥션 생성 비용이 비싸기 때문**입니다.

### 커넥션 생성 비용이 비싼 이유?
- DB 드라이버를 통해 DB와 **TCP 핸드쉐이크 과정**을 거친 뒤, **아이디 패스워드로 인증**을 진행합니다. 정상이면 **DB 드라이버가 커넥션을 생성**하는데 이 커넥션으로 데이터를 주고 받을 수 있게 됩니다. 이러한 과정을 매번 거치기 때문에 비용이 비싸서 **커넥션 풀이 나타났습니다.**

### 장점
- CPU 및 네트워크 리소스 소모 비용 줄임
### 단점
- **메모리 소모**가 크다
- Connection의 주체는 Thread이기 때문에 Thread와 함께 고려해야 한다.

### 커넥션의 TCP 유지
- 커넥션이 생성되는 시점에 TCP 핸드쉐이크에 의해 연결이 수립된다. 이 연결은 커넥션이 생성되어 있는 기간동안 유지되며 히카리 cp 같은 경우에는 별도 쓰레드를 두어 tcp 유지 여부를 확인한다. 즉, 커넥션이 살아있으면 3way handshake 생략하고 쿼리를 바로 요청할 수 있다.

### 커넥션 풀 생성 시점
- 애플리케이션 **시작 시점**에 생성된다. 애플리케이션이 **종료되면 커넥션이 모두 닫히고 풀도 닫힌다**.

### 커넥션 풀 전략
#### 초기 커넥션 풀 전략
- 애플리케이션 시작 시 미리 생성할 커넥션의 수를 생성합니다.
- 장점
	- 첫 요청 시 대기 시간을 줄일 수 있습니다.
- 단점
	- 불필요한 커넥션이 생성될 수 있습니다.

#### 최대 커넥션 수 제한
- 커넥션 풀에서 허용할 커넥션 수를 제한합니다.
- **장점**
	- 불필요한 커넥션 생성을 방지할 수 있습니다. (과부하 방지)
- **단점**
	- 갑자기 많은 커넥션이 필요한 경우, 대기 시간이 증가할 수 있습니다.

### 커넥션 유효성 검사
- 커넥션이 유효한지 확인합니다.
- 장점
	- 애플리케이션 안정성을 높입니다.
- 단점
	- 추가 시간이 발생할 수 있습니다.
### 커넥션 재사용 전략
- 사용 완료된 커넥션을 반환하여 재사용할 수 있게 합니다.
- 장점
	- 커넥션을 효율적으로 사용할 수 있습니다.
- 단점
	- 다수의 요청이 동시에 들어오면 커넥션이 부족할 수 있습니다.

### 커넥션 타임아웃 설정
- 커넥션을 사용하지 않는 시간이 경과할 경우, 해당 커넥션을 종료합니다.
- 장점
	- 리소스 절약이 가능합니다.
- 단점
	- 타임아웃이 짧으면, 필요한 경우에도 갑작스럽게 종료될 수 있습니다.

### 커넥션 타임아웃이 짧으면?
- 커넥션 타임아웃이 짧으면 고부하 작업 시, 커넥션이 반환되어 작업이 완료되지 않을 수 있다. 예를 들어 대량의 데이터를 변경해야 하는 경우 짧은 타임아웃으로 인해 작업이 정상적으로 완료되지 않는다. 트랜잭션 또한 보장할 수 없기 때문에 어떤 문제가 발생할지 예측하기 어려워진다.

### 커넥션 릭
- 커넥션 릭은 커넥션이 적절히 반환되거나 종료되지 않아, **커넥션 풀이 고갈**되는 현상을 의미한다.
- 방지 방법 : 커넥션 타임아웃, 커넥션 헬스체크


https://www.baeldung.com/java-connection-pooling
https://medium.com/swlh/connection-pooling-3-things-you-need-to-know-to-build-a-connection-pool-from-scratch-9d9d4d5ff396