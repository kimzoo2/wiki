# 트랜잭션 격리수준이란?
- 여러 트랜잭션이 **동시에 실행될 때 다른 트랜잭션에서 변경하거나 조회하는 데이터를 볼 수 있도록 허용할지 말지, 결정하는 것**이다. 고립도가 높아지는 수준에 따라 **READ UNCOMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE**로 나뉜다.

### READ UNCOMITTED
- 다른 트랜잭션이 **변경하고 커밋하지 않은 데이터를 조회할 수 있는 레벨**이다. 더티 리드, 논 리피터블 리드, 팬텀 리드 현상이 발생한다.

### READ COMITTED
- 다른 트랜잭션이 변경하고 커밋한 데이터를 조회할 수 있는 레벨이다. 논 리피터블 리드, **팬텀 리드** 현상이 발생한다.

### REPEATABLE READ
- 논 리피터블 리드 현상이 발생하지 않는 레벨이다. innoDB는 **언두로그의 데이터를 조회**하기 때문에 트랜잭션 내에서 똑같은 select를 실행하면 같은 값을 가지도록 보장해준다. innoDB 환경에서는 MVCC 덕분에 **팬텀 리드** 현상도 발생하지 않는다.
- (중요하진 않지만) 리드 커밋드와 리피터블 리드의 차이점은 레코드의 버전들 중에 몇 번째 버전까지 찾는지?의 차이다.

### SERIALIZABLE READ
- 가장 고립 수준이 높은 isolation level이다. 읽기 행위도 **s-lock**이 획득되기 때문에 다른 트랜잭션이 변경하지 못하게 한다. 팬텀 리드도 발생하지 않는다.

# isolation level과 이상 현상
## dirty read
- 커밋 되지 않은 **데이터를 조회할 수 있는 현상**을 의미한다. 
### 왜 더티 리드 현상이 발생하면 안 될까?
- 예를 들어, 만원 있는 계좌에서 두개의 트랜잭션이 1000원씩 빼는 상황을 가정한다. 하나의 트랜잭션이 계좌에서 1000원을 빼는 행위를 한다. 이때 커밋되지 않은 상태다. 이때 다른 트랜잭션이 계좌를 조회하면 9,000원인 상태에서 1,000원을 뺀다. 만약 첫번째 트랜잭션이 다른 이유로 롤백된다면? 결과적으로 계좌는 천원을 사용했지만 2,000원을 사용한 꼴이 된다.

## non-repeatable read
- 하나의 트랜잭션 내에서 같은 select를 실행할 때 다른 트랜잭션의 변경에 의해 값이 달라지는 현상을 의미한다.
### 왜 논 리피터블 리드 현상이 발생하면 안 될까?
- 계좌 잔액을 조회한다고 가정해본다. 하나의 트랜잭션이 아이템에 대한 계좌 잔액을 여러번 조회하는데 다른 트랜잭션이 입출금을 수행하면 계좌 잔액은 하나의 트랜잭션이어도 조회할 때마다 값이 달라질 것이다.

## phantom read
- 다른 트랜잭션에서 수행한 변경 작업에 의해 레코드가 보였다, 안 보였다 하는 행위를 의미한다.

### 왜 팬텀리드 현상이 발생하면 안 될까?
- **일일 매출** 통계를 가져올 때 여러번 조회한다고 가정한다. 하나의 트랜잭션이 일일 매출을 여러번 조회한다면 다른 트랜잭션이 매출 추가를 반복하면 일일 매출을 조회할 때마다 값이 달라질 것이다.



https://medium.com/@iamssrofficial/concurrency-in-databases-database-isolation-levels-dirty-read-phantom-read-non-repeatable-read-320ff3553d6d