## JPA N+1 문제란?
- 다대일, 일대다 등의 **연관관계에서 발생하는 문제**입니다.
- **실행한 쿼리 하나**와 관련된 **연관관계 조회 쿼리 N개가 호출**되는 문제입니다.
### 왜?
- [[JPQL이란?|JPQL]]의 첫 쿼리에서 관련 엔티티까지 가져오지 않고, **관련 엔티티를 사용할 때 추가로 조회**하기 때문입니다.

### 해결 방법
**Lazy Loading**
- 사용시에 로딩하는 Lazy Loading 전략
단점
- 사용 시에는 N번의 쿼리가 호출될 수 있다는 단점이 있다.
### fetch join
- fetch join은 쿼리 한 번으로 **연관관계에 있는 데이터를 모두 조회**하는 방법
단점
- **paiging** 처리가 불가하다.
	- paiging을 메모리에서 처리하기 때문에 `OutOfMemory`가 발생할 수 있다.
- **쿼리를 매번 작성**해야 한다.

**언제 사용?**
- 페이징 필요 없을 때
- 필요한 연관관계를 모두 알 때 (선언 해야 하니까)

#### @BatchSize + Lazy Loading
- where 절이 같은 select 쿼리를 하나의 in 절로 변경해준다.
- size는 in절에 들어갈 수 있는 변수 개수.

**언제 사용?**
- 엔티티 중에 **일부 연관된 데이터를 가져오고 싶을 때 사용**한다.



https://www.baeldung.com/spring-hibernate-n1-problem